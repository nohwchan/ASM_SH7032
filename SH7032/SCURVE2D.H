;*************************************
;--------S CURVE PROCESS-------------*
;*************************************
	MOV D_INCREA2,R0	;COUNT TIME FOR CAL. PARABOLA SPEED RANGE
	MOV @R0,R1		;COUNT EVERY 1MS.
	ADD #1,R1
	MOV R1,@R0		

	MOV #10,R2		;COUNT EVERY 10MS.
	CMP/EQ R2,R1
	BF D_NO10MSEC2
	MOV D_MSEC102,R3
	MOV @R3,R4
	ADD #1,R4
	MOV R4,@R3
	MOV #0,R5
	MOV R5,@R0
D_NO10MSEC2:
	MOV D_MSEC102,R3		;MOVE TIME FOR CAL TO R1
	MOV @R3,R1
	
	MOV DEC_END_R_,R10
	MOV @R10,R10
	MOV #18,R11
	CMP/GT R11,R10		;IF DEC_END_R > 1.8s
	BT  D_METHOD22		;THEN USING METHOD22(FOR NOT OVERFLOW)
	MULS R1,R1
	STS MACL,R3
	MOV D_KRATE2_,R10
	MOV @R10,R2
	MULS R2,R3
	STS MACL,R3
	SHAR R3
	BRA D_JOIN2
	NOP

D_METHOD22:
	MOV D_KRATE2_,R10
	MOV @R10,R2
	MULS R1,R2		;FRUN = 0.5*RATE OF ACCEL*t^2
	STS MACL,R3
	SHAR R3
	MULS R1,R3
	STS MACL,R3

D_JOIN2:
	MOV DMAX_,R10
	MOV @R10,R5
	MOV #10,R0
	MULS R0,R1
	STS MACL,R4

	MULS R4,R5
	STS MACL,R5
	SUB R3,R5
	MOV DC1000,R4
	DIVS R4,R5

	MOV DEC_END_R_,R10
	MOV @R10,R6
	MOV #10,R0
	MULS R0,R6
	STS MACL,R6
	CMP/EQ R6,R1
	BT D_FSET_FRUN

	MOV D_INITIAL2_,R10
	MOV @R10,R2
	SUB R5,R2

	MOV D_FRUNS2,R0		;STORE FRUN
	MOV.W R2,@R0
	BRA OUT_S_CURVE2D
	NOP

D_FSET_FRUN:
	MOV D_FSETS2,R0
	MOV.W @R0,R1

	MOV #1,R2
	SUB R2,R1		;SUBSTRACT WITH 1 FOR COMPARE DC BREAK STOP

	MOV D_FRUNS2,R0
	MOV.W R1,@R0

	BRA OUT_S_CURVE2D
	NOP
		.ALIGN 4

D_INCREA2: 	.DATA.L D_INCREA2_
D_FRUNS2:	.DATA.L FRUN
D_FSETS2:	.DATA.L FSET
DEC_END_R_:	.DATA.L _DEC_END_R
D_KRATE2_:	.DATA.L _D_KRATE2 ;da/dt
D_MSEC102:	.DATA.L D_MSEC102_
D_INITIAL2_:	.DATA.L _D_INITIAL2
STPFRE2:	.DATA.L _STP_FRE
		.ALIGN 4
OUT_S_CURVE2D:

