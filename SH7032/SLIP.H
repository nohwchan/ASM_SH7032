;********************************************
;------------SLIP COMPENSATION--------------*
;********************************************
	MOV IMOTOR2,R1
	MOV @R1,R1		;R1=IMOTOR
	MOV #40,R0
	MULS R0,R1
	STS MACL,R2
	MOV #100,R0
	DIVS R0,R2		;R2=0.4*IMOTOR
	MOV IRMS2,R3
	MOV @R3,R3		;R3=IRMS
	CMP/GT R2,R3		;IF IRMS > 0.4*IMOTOR
	BF  ZERO_DELTA		
	MOV SLIP_FRE,R4		;THEN CALCULATE SLIP COMPENSATE
	MOV.W @R4,R4
;IMPROVE2
SHAR R3
;IMPROVE2
        MULS R3,R4
	STS MACL,R5
;IMPROVE2
SHAL R5
;IMPROVE2
        DIVS R1,R5
	MOV DEL_FREQ,R1
	MOV.W R5,@R1		;R5=DEL_FREQ=(SLIP_FRE*IRMS)/IMOTOR
	BRA OUT_SLIP
	NOP
ZERO_DELTA:
	MOV DEL_FREQ,R1
	MOV #0,R0
	MOV.W R0,@R1		;CLEAR DEL_FRE
	BRA OUT_SLIP
	NOP	

	.ALIGN 4
IMOTOR2:	.DATA.L I_MOTOR
IRMS2:		.DATA.L I_RMS
SLIP_FRE:	.DATA.L _SLIP_FRE
DEL_FREQ:	.DATA.L _DEL_FREQ
	.ALIGN 4
OUT_SLIP:

	
