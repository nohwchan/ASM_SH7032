;********************************************
;------------SLIP COMPENSATION--------------*
;********************************************
	MOV IMOTOR2VF,R1
	MOV @R1,R1		;R1=IMOTOR
	MOV #40,R0
	MULS R0,R1
	STS MACL,R2
	MOV #100,R0
	DIVS R0,R2		;R2=0.4*IMOTOR
	MOV IRMS2VF,R3
	MOV @R3,R3		;R3=IRMS
	CMP/GT R2,R3		;IF IRMS > 0.4*IMOTOR
	BF  ZERO_DELTA_VF		
	MOV SLIP_FREVF,R4		;THEN CALCULATE SLIP COMPENSATE
	MOV.W @R4,R4
;IMPROVE2
SHAR R3
;IMPROVE2
        MULS R3,R4
	STS MACL,R5
;IMPROVE2
SHAL R5
;IMPROVE2
        DIVS R1,R5
	MOV DEL_FREQVF,R1
	MOV.W R5,@R1		;R5=DEL_FREQ=(SLIP_FRE*IRMS)/IMOTOR
	BRA OUT_SLIP_VF
	NOP
ZERO_DELTA_VF:
	MOV DEL_FREQVF,R1
	MOV #0,R0
	MOV.W R0,@R1		;CLEAR DEL_FRE
	BRA OUT_SLIP_VF
	NOP	

	.ALIGN 4
IMOTOR2VF:	.DATA.L I_MOTOR
IRMS2VF:	.DATA.L I_RMS
SLIP_FREVF:	.DATA.L _SLIP_FRE
DEL_FREQVF:	.DATA.L _DEL_FREQ
	.ALIGN 4
OUT_SLIP_VF:

	
