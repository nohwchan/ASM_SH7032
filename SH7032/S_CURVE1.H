;*************************************
;--------S CURVE PROCESS-------------*
;*************************************
	MOV INCREA,R0		;COUNT TIME FOR CAL. PARABOLA SPEED RANGE
	MOV @R0,R1		;COUNT EVERY 1MS.
	ADD #1,R1
	MOV R1,@R0		

	MOV #10,R2		;COUNT EVERY 10MS.
	CMP/EQ R2,R1
	BF NO10MSEC
	MOV MSEC10,R3
	MOV @R3,R4
	ADD #1,R4
	MOV R4,@R3
	MOV #0,R5
	MOV R5,@R0
NO10MSEC:
	MOV MSEC10,R3		;MOVE TIME FOR CAL TO R1
	MOV @R3,R1
	
	MOV ACC_START1,R10
	MOV @R10,R10
	MOV #18,R11
	CMP/GT R11,R10		;IF ACC_START > 1.8s 
	BT  METHOD2		;THEN USING METHOD2(FOR NOT OVERFLOW)
	MULS R1,R1		
	STS MACL,R3
	MOV KRATE1_,R10
	MOV @R10,R2
	MULS R2,R3
	STS MACL,R3
	SHAR R3
	BRA JOIN
	NOP

METHOD2:	
	MOV KRATE1_,R10
	MOV @R10,R2
	MULS R1,R2		;FRUN = 0.5*RATE OF ACCEL*t^2
	STS MACL,R3
	SHAR R3
	MULS R1,R3
	STS MACL,R3
JOIN:
	MOV K1000,R4
	DIVS R4,R3
	MOV INITIALA,R0
	MOV @R0,R4
	ADD R4,R3
	MOV FRUNS,R0		;STORE FRUN
	MOV.W R3,@R0
	BRA OUT_S_CURVE
	NOP


		.ALIGN 4

INCREA: 	.DATA.L INCREA_
FSETS:		.DATA.L FSET
FRUNS:		.DATA.L FRUN
ACCTIMS:	.DATA.L ACC_TIM
DECTIMS:	.DATA.L DEC_TIM
SYSFLGS:	.DATA.L SYSFLG
RSTATUSS:	.DATA.L _R_STATUS
PSTATUSS:       .DATA.L _P_STATUS
K1000:		.DATA.L 1000
KRATE1_:	.DATA.L _KRATE1 ;da/dt
MSEC10:		.DATA.L MSEC10_
VALUE:		.DATA.L 500000	;(50 HZ SCALE WITH 10000)
ACC_START1:	.DATA.L _ACC_START_R
OUT_S_CURVE:

