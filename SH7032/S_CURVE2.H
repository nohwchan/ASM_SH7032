;*************************************
;--------S CURVE PROCESS-------------*
;*************************************
	MOV INCREA2,R0		;COUNT TIME FOR CAL. PARABOLA SPEED RANGE
	MOV @R0,R1		;COUNT EVERY 1MS.
	ADD #1,R1
	MOV R1,@R0		

	MOV #10,R2		;COUNT EVERY 10MS.
	CMP/EQ R2,R1
	BF NO10MSEC2
	MOV MSEC102,R3
	MOV @R3,R4
	ADD #1,R4
	MOV R4,@R3
	MOV #0,R5
	MOV R5,@R0
NO10MSEC2:
	MOV MSEC102,R3		;MOVE TIME FOR CAL TO R1
	MOV @R3,R1
	
	MOV ACC_END_R_,R10
	MOV @R10,R10
	MOV #18,R11
	CMP/GT R11,R10		;IF ACC_END_R_ > 1.8s
	BT  METHOD22		;THEN USING METHOD22(FOR NOT OVERFLOW)
	MULS R1,R1
	STS MACL,R3
	MOV KRATE2_,R10
	MOV @R10,R2
	MULS R2,R3
	STS MACL,R3
	SHAR R3
	BRA JOIN1
	NOP

METHOD22:
	MOV KRATE2_,R10
	MOV @R10,R2
	MULS R1,R2		;FRUN = 0.5*RATE OF ACCEL*t^2
	STS MACL,R3
	SHAR R3
	MULS R1,R3
	STS MACL,R3
JOIN1:
	MOV AMAX_,R10
	MOV @R10,R5
	MOV #10,R0
	MULS R0,R1
	STS MACL,R4
	MULS R4,R5
	STS MACL,R5
	SUB R3,R5
	MOV C1000,R4
	DIVS R4,R5

	MOV ACC_END_R_,R10	;GET ACC_END_R_ TIME FOR COMPARE
	MOV @R10,R6

	MOV #10,R0		;SCALE TIME WITH 10
	MULS R0,R6
	STS MACL,R6

	CMP/EQ R6,R1
	BT FSET_FRUN

	MOV INITIAL2_,R10
	MOV @R10,R2
	ADD R2,R5

	MOV FRUNS2,R0		;STORE FRUN
	MOV.W R5,@R0
	BRA OUT_S_CURVE2
	NOP

FSET_FRUN:
	MOV FSETS2,R0
	MOV.W @R0,R1
	MOV FRUNS2,R0
	MOV.W R1,@R0
	
	BRA OUT_S_CURVE2
	NOP
		.ALIGN 4

INCREA2: 	.DATA.L INCREA2_
FRUNS2:		.DATA.L FRUN
FSETS2:		.DATA.L FSET
ACCTIMS2:	.DATA.L ACC_TIM
DECTIMS2:	.DATA.L DEC_TIM
SYSFLGS2:	.DATA.L SYSFLG
RSTATUSS2:	.DATA.L _R_STATUS
PSTATUSS2:      .DATA.L _P_STATUS
ACC_END_:	.DATA.L _ACC_END
ACC_END_R_:     .DATA.L _ACC_END_R
C1000:		.DATA.L 1000
KRATE2_:	.DATA.L _KRATE2 ;da/dt
MSEC102:	.DATA.L MSEC102_
VALUE2:		.DATA.L 500000	;(50 HZ SCALE WITH 10000)
AMAX_:		.DATA.L _AMAX
INITIAL2_:	.DATA.L _INITIAL2
OUT_S_CURVE2:

