;**************************************************
;----------------UP/DOWN CONTROL-------------------
;**************************************************

	MOV INP_LOW,R1
	MOV.W @R1,R0		;INPORT LOW BYTE OF EXTERNAL(FOR UP/DOWN CHECKING)

	MOV BITMASK,R1
	AND R1,R0		;MASK BIT FOR CHECK X1,X2
	SHLR2 R0		;SHIFT BIT X1,X2 FOR CHECK(UP/DOWN)
	CMP/EQ #1,R0		;IF X1=0,X2=1
	BT UP_CON		;THEN UP_CON
	CMP/EQ #2,R0		;IF X1=1,X2=0
	BT DOWN_CON		;THEN DOWN_CON
	MOV S_STATUS4,R1
	MOV.B @R1,R0
	OR #B'100000,R0		;SET UP/DWN CON.BUT NO X1,X2 FLAG
	MOV.B R0,@R1

	BRA OUT_UP_DOWN
	NOP
	
UP_CON:
	    MOV FSAT_4,R2
	    MOV.W @R2,R2			    
            MOV FSET_4,R1
            MOV.W R2,@R1	;STORE FSAT TO FSET
	MOV S_STATUS4,R1
	MOV.B @R1,R0
	AND #B'11011111,R0	;CLEAR FLAG. WHEN X1 OR X2 IN
	MOV.B R0,@R1

            BRA OUT_UP_DOWN
            NOP

DOWN_CON:

	MOV #0,R0		;CHANGE FSET = 0
	MOV FSET_4,R1
	MOV.W R0,@R1
	MOV S_STATUS4,R1
	MOV.B @R1,R0
	AND #B'11011111,R0	;CLEAR FLAG WHEN X1 OR X2 IN
	MOV.B R0,@R1

	BRA OUT_UP_DOWN
	NOP


		.ALIGN 4
INP_LOW:	.DATA.L INPORT	
INP_HI1:	.DATA.L IN_PORT2	;VARIABLE IN S.MAC
FSET_4:		.DATA.L FSET
FSAT_4:		.DATA.L _F_SAT
BITMASK:	.DATA.L B'0000000000001100
S_STATUS4:	.DATA.L _S_STATUS
QSTATUS1_:	.DATA.L _Q_STATUS	;VARIABLE IN S.MAC
OUTOFLOOP:	.DATA.L OUT_LOOP

OUT_UP_DOWN:
